---
title: "Architecture modulaire Azure avec Terraform : Networking, Compute, Load Balancing & Bastion"
excerpt: "Projet complet d'infrastructure as code (IaC) sur Azure avec Terraform. D√©coupage en modules ind√©pendants (Networking, Compute, LB, Bastion), gestion de state files s√©par√©s, respect des bonnes pratiques DevOps et s√©curit√©. Simule une collaboration entre √©quipes IT dans un environnement de production."
header:
  overlay_image: /assets/images/terraform-azure-hero.jpg
  teaser: /assets/images/terraform-azure-teaser.png
tags: [Azure, Terraform, IaC, Infrastructure as Code, Cloud Engineer, DevOps, Modular Architecture, Remote State, Load Balancer, Bastion, NSG, Cloud-init]
toc: true
toc_sticky: true
classes: wide
completion_date: 2025-09-30
github_repo: https://github.com/stanilpaul/project1_terraform_module
tf_registry: https://registry.terraform.io/search/modules?q=stanilpaul
---

<video autoplay muted loop playsinline controls preload="metadata" width="100%">
  <source src="{{ '/assets/videos/demo-pro1-terra-module.mp4' | relative_url }}" type="video/mp4">
  Votre navigateur ne supporte pas la vid√©o.
</video>

> üìÖ **Date de r√©alisation** : {{ page.completion_date | date: "%d %B %Y" }}

---

## üéØ Probl√©matique & Contexte m√©tier

> *Comment concevoir une infrastructure cloud s√©curis√©e, reproductible, et maintenable par plusieurs √©quipes m√©tiers, tout en respectant les bonnes pratiques DevOps et les standards de production ?*

### Le d√©fi

En entreprise, les infrastructures cloud ne sont pas g√©r√©es par une seule personne. Elles impliquent :
- Une **√©quipe r√©seau** (VNet, NSG, NAT, IPs)
- Une **√©quipe compute** (VMs, disques, scripts d‚Äôinitialisation)
- Une **√©quipe SRE/Infra** (Load Balancers, monitoring, scalabilit√©)
- Une **√©quipe support/s√©curit√©** (acc√®s bastion, audit)

Souvent, ces √©quipes doivent :
- Travailler **ind√©pendamment**
- Partager des **outputs sans se bloquer**
- Garantir la **s√©curit√© des √©tats et secrets**
- Pouvoir **ajouter/supprimer des ressources dynamiquement**

üëâ Ce projet simule exactement ce sc√©nario avec Terraform, en cr√©ant **4 modules ind√©pendants**, chacun avec son propre **remote state file**, comme dans un vrai environnement de production.

---

## üì∏ Galerie de captures d‚Äô√©cran

<div class="screenshots-grid">
  <a href="{{ '/assets/images/pro1-terra-module/public_module.png' | relative_url }}" target="_blank" title="Public Terraform Module">
    <img src="{{ '/assets/images/pro1-terra-module/public_module.png' | relative_url }}" alt="Public Terraform Module" loading="lazy" />
    <span>Public Terraform Module</span>
  </a>
  <a href="{{ '/assets/images/pro1-terra-module/private_module.png' | relative_url }}" target="_blank" title="Private Terraform Module">
    <img src="{{ '/assets/images/pro1-terra-module/private_module.png' | relative_url }}" alt="Private Terraform Module" loading="lazy" />
    <span>Private Terraform Module</span>
  </a>
  <a href="{{ '/assets/images/pro1-terra-module/github.png' | relative_url }}" target="_blank" title="GitHub Repos">
    <img src="{{ '/assets/images/pro1-terra-module/github.png' | relative_url }}" alt="GitHub" loading="lazy" />
    <span>GitHub Repos</span>
  </a>
  <a href="{{ '/assets/images/pro1-terra-module/networking.png' | relative_url }}" target="_blank" title="Networking Module">
    <img src="{{ '/assets/images/pro1-terra-module/networking.png' | relative_url }}" alt="Networking" loading="lazy" />
    <span>Networking</span>
  </a>
  <a href="{{ '/assets/images/pro1-terra-module/compute.png' | relative_url }}" target="_blank" title="Compute Module">
    <img src="{{ '/assets/images/pro1-terra-module/compute.png' | relative_url }}" alt="Compute" loading="lazy" />
    <span>Compute</span>
  </a>
  <a href="{{ '/assets/images/pro1-terra-module/lb.png' | relative_url }}" target="_blank" title="Load Balancing Module">
    <img src="{{ '/assets/images/pro1-terra-module/lb.png' | relative_url }}" alt="Load balancing" loading="lazy" />
    <span>Load Balancing</span>
  </a>
  <a href="{{ '/assets/images/pro1-terra-module/bastion.png' | relative_url }}" target="_blank" title="Bastion Module">
    <img src="{{ '/assets/images/pro1-terra-module/bastion.png' | relative_url }}" alt="Bastion" loading="lazy" />
    <span>Bastion</span>
  </a>
  <a href="{{ '/assets/images/pro1-terra-module/backend_github.png' | relative_url }}" target="_blank" title="Backend GitHub">
    <img src="{{ '/assets/images/pro1-terra-module/backend_github.png' | relative_url }}" alt="Backend Github" loading="lazy" />
    <span>Backend GitHub</span>
  </a>
  <a href="{{ '/assets/images/pro1-terra-module/network_apply.png' | relative_url }}" target="_blank" title="Network Apply">
    <img src="{{ '/assets/images/pro1-terra-module/network_apply.png' | relative_url }}" alt="Network Apply" loading="lazy" />
    <span>Network Apply</span>
  </a>
  <a href="{{ '/assets/images/pro1-terra-module/4containers.png' | relative_url }}" target="_blank" title="4 State Containers">
    <img src="{{ '/assets/images/pro1-terra-module/4containers.png' | relative_url }}" alt="4 Containers" loading="lazy" />
    <span>4 Containers</span>
  </a>
  <a href="{{ '/assets/images/pro1-terra-module/remote-state.png' | relative_url }}" target="_blank" title="Remote State Files">
    <img src="{{ '/assets/images/pro1-terra-module/remote-state.png' | relative_url }}" alt="Remote state" loading="lazy" />
    <span>Remote State</span>
  </a>
  <a href="{{ '/assets/images/pro1-terra-module/web1.png' | relative_url }}" target="_blank" title="Web Site 1 (External LB)">
    <img src="{{ '/assets/images/pro1-terra-module/web1.png' | relative_url }}" alt="Web 1" loading="lazy" />
    <span>Web 1 (External)</span>
  </a>
  <a href="{{ '/assets/images/pro1-terra-module/web2.png' | relative_url }}" target="_blank" title="Web Site 2 (Internal LB)">
    <img src="{{ '/assets/images/pro1-terra-module/web2.png' | relative_url }}" alt="Web 2" loading="lazy" />
    <span>Web 2 (Internal)</span>
  </a>
</div>

<style>
.screenshots-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 20px;
  padding: 20px 0;
  margin: 32px 0;
}

.screenshots-grid a {
  display: flex;
  flex-direction: column;
  text-decoration: none;
  color: #333;
  transition: transform 0.2s ease;
}

.screenshots-grid a:hover {
  transform: translateY(-4px);
}

.screenshots-grid img {
  width: 100%;
  height: 200px;
  object-fit: cover;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  transition: box-shadow 0.2s ease;
}

.screenshots-grid a:hover img {
  box-shadow: 0 8px 16px rgba(0,0,0,0.15);
}

.screenshots-grid span {
  margin-top: 8px;
  font-size: 0.9em;
  text-align: center;
  font-weight: 500;
  color: #555;
}

@media (max-width: 768px) {
  .screenshots-grid {
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 16px;
  }
  .screenshots-grid img {
    height: 160px;
  }
  .screenshots-grid span {
    font-size: 0.85em;
  }
}
</style>

---

## üí° Objectifs techniques

‚úÖ Concevoir une architecture modulaire avec **Terraform**  
‚úÖ Utiliser **des state files s√©par√©s** stock√©s dans Azure Blob Storage  
‚úÖ Appliquer le principe de **responsabilit√© unique par module**  
‚úÖ Automatiser le d√©ploiement de VMs avec **cloud-init** (Apache2)  
‚úÖ Mettre en place **2 load balancers** (externe + interne)  
‚úÖ G√©rer les acc√®s via **NSG + Bastion + NAT Gateway**  
‚úÖ Standardiser les noms, tags, et plages IP  
‚úÖ Valider le code avec **TF Lint**  
‚úÖ G√©n√©rer automatiquement la **documentation (README.md)** avec `terraform-docs`  
‚úÖ Publier les modules sur **Terraform Registry + GitHub**  
‚úÖ √âviter `count`, privil√©gier les **map objects dynamiques**  
‚úÖ Rendre l‚Äôinfrastructure **extensible** (n VMs, n subnets, etc.)

---

## üèóÔ∏è Architecture globale

### Sch√©ma d‚Äôarchitecture

<div style="overflow-x:auto; text-align:center;">
  <a href="{{ '/assets/images/terraform-module-pro1.svg' | relative_url }}" target="_blank">
    <img src="{{ '/assets/images/terraform-module-pro1.svg' | relative_url }}" 
         style="width:100%; max-width: 1200px; height:auto; border: 1px solid #eee; border-radius: 8px;" 
         alt="Architecture Terraform Azure Modulaire">
  </a>
  <p><em>Cliquez pour agrandir</em></p>
</div>

---

## üß© Modules d√©taill√©s

Chaque module repr√©sente une √©quipe m√©tier, avec son propre cycle de vie, ses permissions, et son state file.


### 1. Module `networking-project1` ‚Üí √âquipe R√©seau

üîó [GitHub](https://github.com/stanilpaul/terraform-azurerm-networking-project1)

#### Responsabilit√©s :
- Cr√©ation du **Resource Group**
- D√©ploiement du **VNet + 4 subnets** (auto-calcul√©s via `cidrsubnet`)
- Attribution d‚Äôun **NSG par subnet** (r√®gles standardis√©es via map)
- Cr√©ation de **Public IPs** (pour LB externe + NAT Gateway)
- Mise en place de la **NAT Gateway** (acc√®s sortant pour VMs internes)
- Application de **tags** sur toutes les ressources

#### Inputs requis:
* location
* nat_name
* nsg_rules_simple
* nsg_rules_simple
* rg_name
* subnets
* vnet_address_space
* vnet_name

#### Outputs expos√©s :
```hcl
resource_group, vnet_details, subnets_details, public_ip_details, nsg_details, nat_details
```

### 2. Module `compute-web-tier-project1` ‚Üí √âquipe Infrastructure / VMs

üîó [GitHub](https://github.com/stanilpaul/terraform-azurerm-compute-web-tier-project1)

#### Responsabilit√©s :
- Cr√©ation de **VMs Linux (Ubuntu 22.04 LTS)** via map dynamique
- Association √† **un subnet sp√©cifique**
- Ajout de **disques de donn√©es** persistants
- Installation d‚Äô**Apache2 via cloud-init**
- G√©n√©ration de **NICs** avec NSG attach√©
- Tags + noms standardis√©s

#### Inputs requis:
* instances
* location
* rg_name
* tags

#### Outputs expos√©s :
```hcl
disk_details, nic_details, vm_details
```

### 3. Module `load-balancing-project1` ‚Üí √âquipe SRE / Infra

üîó [GitHub](https://github.com/stanilpaul/terraform-azurerm-load-balancing-project1)

#### Responsabilit√©s :
- Cr√©ation d‚Äôun **Load Balancer externe** (acc√®s public sur port 80 ‚Üí VM1)
- Cr√©ation d‚Äôun **Load Balancer interne** (acc√®s interne ‚Üí VM2)
- Configuration des **rules, probes, backend pools**
- S√©curisation via **NSG implicite** (seulement port 80 autoris√©)

#### Inputs requis:
* internal_lb_name
* internal_subnet_id
* internal_vm_nics
* location
* name_external_lb
* public_ip_id
* public_vm_nics
* rg_name
* tags

#### Outputs expos√©s :
```hcl
external_lb_details, internal_lb_details
```

### 4. Module `bastion-project1` ‚Üí  √âquipe Support / S√©curit√©

üîó [GitHub](https://github.com/stanilpaul/terraform-azurerm-bastion-project1)

#### Responsabilit√©s :
- Cr√©ation d‚Äôun **subnet d√©di√© Bastion**
- D√©ploiement du service **Azure Bastion**
- Attribution d‚Äôune **IP publique d√©di√©e**
- Acc√®s s√©curis√© aux VMs **sans exposer de ports RDP/SSH**

#### Inputs requis:
* bastion_ip_name
* bastion_name
* bastion_subnet_cidr
* location
* rg_name
* vnet_name
* tags

#### Outputs expos√©s :
```hcl
bastion_details
```

---

## üîÑ Workflow de d√©ploiement (Remote State Files)

Chaque module lit uniquement les states dont il a besoin ‚Üí **d√©pendances explicites et contr√¥l√©es**.

### 4 containers Azure distincts :
- `network-terraform-state`
- `vm-terraform-state`
- `loadbalancing-terraform-state`
- `bastion-terraform-state`

### S√©curit√© : 

Les tokens et secrets ne sont jamais commit√©s (`.tfvars` local, `.gitignore` strict).

---

## üõ†Ô∏è Technologies & Outils utilis√©s


| Cat√©gorie      | Outils & Technologies                                     |
|----------------|-----------------------------------------------------------|
| **Cloud**      | Microsoft Azure                                           |
| **IaC**        | Terraform v1.3+, Modules, Remote State                    |
| **Langage**    | HCL (HashiCorp Language)                                  |
| **Validation** | TF Lint, `terraform validate`                             |
| **Documentation** | terraform-docs, README.md auto-g√©n√©r√©                  |
| **Versioning** | Git, GitHub, Tags SemVer                                  |
| **Publication**| Terraform Registry (Public & Private)                     |
| **OS**         | Ubuntu 22.04 LTS (remplacement de 18.04 EOL)              |
| **Init Scripts** | Cloud-init (Apache2 install)                            |
| **R√©seau**     | VNet, Subnets, NSG, NAT Gateway, Public IPs, Load Balancers |
| **S√©curit√©**   | Bastion Host, Tags, RBAC implicite via modules            |


--- 

## ‚úÖ R√©sultat fonctionnel

* ‚úÖ Acc√®s public via Load Balancer externe ‚Üí VM1 (site web Apache)
* ‚úÖ Acc√®s interne via Load Balancer interne ‚Üí VM2 (site web priv√©)
* ‚úÖ VM2 peut faire apt update gr√¢ce √† la NAT Gateway
* ‚úÖ Acc√®s s√©curis√© aux VMs via Azure Bastion (pas de ports ouverts)
* ‚úÖ Toutes les ressources tagg√©es ‚Üí tra√ßabilit√© et co√ªts
* ‚úÖ Ajout/suppression de VMs ou subnets ‚Üí modification simple de la map d‚Äôentr√©e


---

### D√©monstration vid√©o (3 min)


Dans la vid√©o :
- Je montre le **workflow de d√©ploiement module par module**
- La **connexion au site web public** via LB externe
- L‚Äôacc√®s **interne au site priv√©** via LB interne
- La connexion **s√©curis√©e via Bastion**
- Le contenu des **state files dans Azure Storage Explorer**
  
‚û°Ô∏è Preuve que l‚Äôarchitecture est op√©rationnelle, modulaire, et s√©curis√©e.


---

## üìà Bonnes pratiques mises en ≈ìuvre


| Pratique                     | Impl√©mentation dans le projet                          |
|-------------------------------|-------------------------------------------------------|
| **Infrastructure as Code**    | ‚úÖ 100% Terraform                                      |
| **Modularit√©**                | ‚úÖ 4 modules ind√©pendants                              |
| **Remote State**              | ‚úÖ Backend Azure, 4 state files                        |
| **S√©curit√© des secrets**      | ‚úÖ .tfvars non versionn√©, sensitive outputs            |
| **Extensibilit√©**             | ‚úÖ Maps dynamiques (n VMs, n subnets)                  |
| **Documentation automatique** | ‚úÖ terraform-docs ‚Üí README.md                          |
| **Validation syntaxique**     | ‚úÖ TF Lint + `terraform validate`                      |
| **Naming convention**         | ‚úÖ Standard RG-VNET-VM-LB-BASTION                      |
| **Tagging**                   | ‚úÖ Environnement, Owner, Project sur toutes ressources |
| **√âvitement de count**        | ‚úÖ Utilisation exclusive de `for_each` + maps          |
| **Versioning des modules**    | ‚úÖ Tags SemVer sur GitHub + Registry                   |
| **Collaboration multi-√©quipes** | ‚úÖ Simul√©e via d√©coupage modules/state                |


---

## üöß Limites & Axes d‚Äôam√©lioration


| Ce que j‚Äôai fait                        | Ce qu‚Äôon ferait en production                               |
|-----------------------------------------|-------------------------------------------------------------|
| **Mot de passe en clair dans tfvars**   | ‚û§ Azure Key Vault + `azurerm_key_vault_secret`             |
| **Cloud-init basique**                  | ‚û§ Ansible / Packer pour images custom                      |
| **Pas de CI/CD**                        | ‚û§ Azure DevOps / GitHub Actions pour `terraform apply` auto |
| **Monitoring absent**                   | ‚û§ Azure Monitor + Alertes sur m√©triques VM/LB               |
| **Pas de tests automatis√©s**            | ‚û§ Terratest pour valider connectivit√© / r√®gles NSG          |
| **Modules publi√©s manuellement**        | ‚û§ Release automatis√©e via GitHub Actions                    |

---

## üìö Sources & Inspirations

- [Chief Architect @ Microsoft](https://www.youtube.com/watch?v=esvtvKB8LSQ&list=PLk-ELTMns8FZc9FuzeMv-Xg0UaMS6_6jq)
- [Microsoft Learn](https://learn.microsoft.com/en-us/azure/developer/terraform/)
- [HashiCorp Learn](https://learn.microsoft.com/en-us/azure/developer/terraform/)
- [Mes labs personnels](https://github.com/stanilpaul/learning_terraform_2nd_time)

üßë‚Äçüíª Pourquoi ce projet compte pour mon profil d‚Äôing√©nieur cloud

> *‚ÄúCe projet n‚Äôest pas juste un **lab**.  
> C‚Äôest une simulation de production r√©elle qui d√©montre :‚Äù*


* Ma ma√Ætrise de Terraform avanc√© (modules, remote state, variables dynamiques)
* Ma capacit√© √† structurer une infrastructure complexe pour des √©quipes multiples
* Mon attention aux bonnes pratiques DevOps (s√©curit√©, validation, documentation)
* Ma rigueur dans la gestion des d√©pendances et des √©tats
* Mon autonomie pour r√©soudre des erreurs complexes (ex: image Ubuntu EOL, outputs sensibles, etc.)
* Mon souci de qualit√© et professionnalisme (lint, docs auto, tags, naming)


---

## üìé Annexes

- [üìÅ Code source complet du projet](https://github.com/stanilpaul/project1_terraform_module)
- [üìÅ Code source Module Networking](https://github.com/stanilpaul/terraform-azurerm-networking-project1)
- [üìÅ Code source Module Compute](https://github.com/stanilpaul/terraform-azurerm-compute-web-tier-project1)
- [üìÅ Code source Module Load Balancing](https://github.com/stanilpaul/terraform-azurerm-load-balancing-project1)
- [üìÅ Code source Module Bastion](https://github.com/stanilpaul/terraform-azurerm-bastion-project1)
- [üìÅ Code Source Pr√©paration pour ce projet](https://github.com/stanilpaul/learning_terraform_2nd_time)
- [üì¶ Modules Terraform](https://registry.terraform.io/namespaces/stanilpaul)

---

## üöÄ Prochaines √©tapes

- Int√©grer Azure Key Vault pour les secrets
- Ajouter du CI/CD avec GitHub Actions
- √âcrire des tests d‚Äôint√©gration avec Terratest
- Containeriser les apps avec Docker + Azure Container Instances
- Ajouter du monitoring avec Azure Monitor + Grafana

---

## üß† Ce que j‚Äôai appris gr√¢ce √† ce projet

> *‚ÄúLes erreurs ont √©t√© mes meilleurs professeurs.‚Äù*

- ‚úÖ G√©rer les d√©pendances entre modules sans cr√©er de spaghetti
- ‚úÖ Comprendre pourquoi Ubuntu 18.04 dispara√Æt soudainement üòÖ ‚Üí gestion du cycle de vie des images
- ‚úÖ Ma√Ætriser `sensitive = true` et ne jamais exposer un mot de passe par accident
- ‚úÖ Automatiser la doc avec `terraform-docs` ‚Üí gagner 2h/semaine en maintenance
- ‚úÖ Travailler avec des state files s√©par√©s ‚Üí √©viter les conflits en √©quipe
- ‚úÖ Simuler un workflow multi-√©quipes ‚Üí penser comme un architecte, pas juste un dev

‚û°Ô∏è Ce projet m‚Äôa transform√© d‚Äôun utilisateur de Terraform √† un **concepteur d‚Äôinfrastructures modulaires**.